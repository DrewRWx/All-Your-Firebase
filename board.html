<!doctype html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />

    <script src='https://cdn.firebase.com/v0/firebase.js'></script>
    <script src='https://ajax.googleapis.com/ajax/libs/jquery/1.9.0/jquery.min.js'></script>
    <script src='./functions.js'></script>
  </head>
  <body>
    <title>cs290b.drew.waran.is</title>

    <div id="tableDiv"></div>

    <script>
      var board = new Array(9);
      var users = new Array();

      for (var i = 0; i < board.length; i++){
        board[i] = '<font color="C0C0C0">' + (i+1) + '</font>';
      }

      var usersRef = new Firebase('https://cs290b.firebaseio.com/users');
      var myDataRef = new Firebase('https://cs290b.firebaseio.com/queue');

      // usersRef.on('child_added', function(snapshot) {
      //   users = snapshot.val();
      //   // console.log(users);
      // });

      // usersRef.on('child_changed', function(snapshot) {
      //   users = snapshot.val();

      //   drawTable(board);
      //   // console.log(users);
      // });

      // usersRef.on('value', function(snapshot) {
      //     users = snapshot.val();
      //     // console.log(users);
      // });

      myDataRef.on('child_added', function(snapshot) {
        
        // usersRef.on('child_changed', function(snapshot) {
        //   users = snapshot.val();
        //   // console.log(users);
        // });

        var message = snapshot.val();
        var mark = message.mark

        if (mark == 'c') {
        mark = '<font color="C0C0C0">' + (message.box+1) + '</font>';
        };

        board[message.box] = mark;

        drawTable(board);

        var winners = determineWinners(board);

        if (! $.isEmptyObject(winners)) {
          alert(stringifyWinners(winners));
        };
      });

      drawTable(board);
    </script>
  </body>
</html>